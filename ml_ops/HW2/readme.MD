# Инструкция по настройке пайплайна
## Шаг 1: Настройка переменных в GitLab CI/CD
Если в .gitlab-ci.yml используются переменные, настройте их в интерфейсе GitLab:

1.	Перейдите в Settings → CI/CD → Variables.
2.	Добавьте следующие переменные:
    - *CI_REGISTRY_IMAGE*: URL вашего контейнерного реестра (например, registry.gitlab.com/your-namespace/your-project).
	- *DEPLOY_USER*: имя пользователя для подключения к серверу через SSH.
	- *DEPLOY_HOST*: IP-адрес или доменное имя вашего сервера.
	- *DEPLOY_SSH_KEY*: приватный SSH-ключ для подключения к серверу (если требуется).
	- *CI_COMMIT_SHORT_SHA*: (опционально, это переменная по умолчанию).

## Шаг 2: Запуск пайплайна

1.	После пуша в ветку main пайплайн запустится автоматически.
2.	Перейдите в CI/CD → Pipelines в вашем проекте на GitLab.
3.	Убедитесь, что пайплайн выполняется без ошибок:
- **build_and_push_image**: собирает и пушит Docker-образ.
- **deploy_with_docker_compose**: разворачивает приложение с использованием docker-compose.

## Шаг 3: Проверка результатов

Для **build_and_push_image**:

- Убедитесь, что Docker-образ успешно создан и запушен в контейнерный реестр.
- Зайдите в GitLab Container Registry или Docker Hub, чтобы проверить наличие образа.

Для **deploy_with_docker_compose**:
- Убедитесь, что docker-compose.yml был успешно скопирован на сервер.
- Проверьте, что контейнеры запущены:
```bash
ssh <DEPLOY_USER>@<DEPLOY_HOST> "docker ps"
```
Проверьте, что приложение работает (например, через браузер или команду curl):
```bash
curl http://<DEPLOY_HOST>:8080
```
